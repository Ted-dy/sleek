package me.kansio.client.modules.impl.exploit;

import com.google.common.eventbus.Subscribe;
import me.kansio.client.event.impl.PacketEvent;
import me.kansio.client.modules.api.ModuleCategory;
import me.kansio.client.modules.api.ModuleData;
import me.kansio.client.modules.impl.Module;
import me.kansio.client.utils.network.PacketUtil;
import net.minecraft.network.play.client.C01PacketChatMessage;
import org.apache.commons.lang3.RandomUtils;

@ModuleData(
        name = "Chat Bypass",
        category = ModuleCategory.EXPLOIT,
        description = "Detects anti filters"
)
public class FilterBypass extends Module {

    @Subscribe
    public void onPacket(PacketEvent event) {
        if (event.getPacket() instanceof C01PacketChatMessage) {
            String msg = ((C01PacketChatMessage) event.getPacket()).getMessage();

            if (msg.startsWith("/")) return;

            //split the msg to a char array
            char[] splitString = msg.toCharArray();
            StringBuilder b = new StringBuilder();

            //loop through them
            for (char c : splitString) {
                //add an invisible character randomly
                if (RandomUtils.nextInt(0, 4) == 0) {
                    b.append("\u061C");
                }

                b.append(c);
            }

            //cancel
            event.setCancelled(true);

            //send the packet
            PacketUtil.sendPacketNoEvent(new C01PacketChatMessage(b.toString()));
        }
    }
}
